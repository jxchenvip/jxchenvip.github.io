---
title: canvas多边形 
categories: 前端
tags: [javascript, html5, canvas]
date: 2017/5/8 15:27:21 
---



<p>我们尝试画一个多边形，需要了解一下什么是多边形：</p>
<blockquote>
<p>“数学用语，由三条或三条以上（在《几何原本》中定义为四条以上）的线段首尾顺次连接所组成的平面图形叫做多边形。按照不同的标准，多边形可以分为正多边形和非正多边形、凸多边形及凹多边形等。”</p>
</blockquote>
<p>正多边形是我们今天讨论的主题：</p>

<h2>中心点</h2>
<p>正多边形都有它的中心点，我们首先要确定中心点，以六边形为例：</p>

<!-- more -->

<style>
	.side_wrap{ margin: 0 auto; width: 320px; }
	.side label{ width: 4em; }
	.side *{ display: inline-block; vertical-align: middle; margin: 0 10px; }
</style>

<h3>创建canvas</h3>
<div id="polygon_dot"></div>

```js
	var SIDE = 6;
	var canvas =  document.createElement('canvas');
	var context = canvas.getContext('2d');
```
<h3>canvas中心点</h3>

```js
	var CX = canvas.width / 2;
	var CY = canvas.height / 2;
```


<h2>半径</h2>
<div id="polygon_radius"></div>

```js
	var RADIUS = canvas.width / 2;
```



<h2>各顶点的坐标</h2>
<div id="polygon_points"></div>


```js
	function d2a(n) {
		return n * Math.PI / 180;
	}

	var angle = 360 / SIDE,
		points = [];
	for(var i = 0; i <= SIDE; i++) {
		var point = {};
		point.x = Math.cos(d2a(angle * i)) * RADIUS + WIDTH / 2;
		point.y = Math.sin(d2a(angle * i)) * RADIUS + HEIGHT / 2;
		points.push(point);
	}

```


<h2>链接各顶点坐标</h2>
<div id="polygon_sides"></div>

```js
	var sides = side_points();
	context.beginPath();
	context.moveTo(sides[0].x, sides[0].y);
	sides.forEach(function(item) {
		context.lineTo(item.x, item.y);
	});
	context.stroke();
	context.closePath();
```
<p>到此我们的六边形就已经完成了，下面我们来修改一下参数来改变我们的多边形</p>

<div class="side_wrap">
	<p class="side"><label>stroke</label><input type="color" value="#000000" id="stroke" ><span id="span_stroke"></span></p>
	<p class="side"><label>fill</label><input type="color" value="#FFFFFF" id="fill" ><span id="span_fill"></span></p>
	<p class="side"><label>opacity</label><input type="range" min="0" step="0.1" max="1" value="1" id="opacity" ><span id="span_opacity"></span></p>
	<p class="side"><label>rotate</label><input type="range" value="0" min="-360" max="360" step="10" id="rotate"><span id="span_rotate"></span></p>
	<p class="side"><label>side</label><input type="range" min="3" max="10" step="1" id="range_side" value="6"> <span id="span_side">6</span></p>
</div>

<div id="polygon_range_side"></div>

<h2><a target="_black" href="https://github.com/jxchenvip/demo/blob/dev/project/canvas/polygon/index.html">#下载源码</a></h2>

<script>

	(function() {
		
		// 不支持canvas
		if(!document.createElement('canvas').getContext) return false;

		/**
		 * [createCanvas 创建canvas元素]
		 * @return {[object]}
		 */
		function createCanvas() {
			var canvas =  document.createElement('canvas');
			var context = canvas.getContext('2d');
			canvas.width = 100;
			canvas.height = 100;
			return context;
		}

		/**
		 * [$ 获取id]
		 * @param  {[String]} id
		 * @return {[object]} dom节点
		 */
		function $(id) {
			return document.getElementById(id);
		}

		/**
		 * [clear 清除画布]
		 * @param  {[object]} context
		 * @return {[void]}       
		 */
		function clear(context) {
			context.clearRect(0, 0, WIDTH, HEIGHT);
		}

		/**
		 * [createCanvasImage description]
		 * @param  {[object]} ele     [dom节点]
		 * @param  {[object]} context [画布]
		 * @return {[void]}
		 */
		function createCanvasImage(ele, context) {
			var img = ele.getElementsByTagName('img')[0],
				src = context.canvas.toDataURL();
			if(img) {
				var a = ele.getElementsByTagName('a')[0];
				a.href = src;
				img.src = src;
			} else {
				ele.innerHTML = "<img src="+src+" alt='' />";
			}
		}

		/**
		 * [createDots 创建中心点]
		 * @param  {[object]} context [画布]
		 * @return {[void]}
		 */
		function createDots(context) {
			context.beginPath();
			context.arc(WIDTH/2, HEIGHT/2, DOTS_RADIUS, 0, PI2);
			context.fill();
			context.closePath();
		}

		/**
		 * [createRadius 创建半径]
		 * @param  {[object]} context [画布]
		 * @return {[void]}         
		 */
		function createRadius(context) {
			context.beginPath();
			context.moveTo(WIDTH/2, HEIGHT/2);
			context.lineTo(WIDTH/2, 0);
			context.stroke();
			context.closePath();
		}

		/**
		 * [d2a 角度转弧度]
		 * @param  {[number]} n [角度]
		 * @return {[number]}   [弧度]
		 */
		function d2a(n) {
			return n * Math.PI / 180;
		}

		/**
		 * [side_points 各边顶点]
		 * @return {[array]} [顶点集合]
		 */
		function side_points() {
			var angle = 360 / SIDE,
				points = [],
				val = rotate.value * 1;
			for(var i = 0; i <= SIDE; i++) {
				var point = {};
				point.x = Math.cos(d2a(angle * i + val)) * RADIUS + WIDTH / 2;
				point.y = Math.sin(d2a(angle * i + val)) * RADIUS + HEIGHT / 2;
				points.push(point);
			}
			return points;
		}

		/**
		 * [createSide 画各顶点]
		 * @param  {[object]} context [画布]
		 * @return {[void]}
		 */
		function createSide(context) {
			var sides = side_points();
			sides.forEach(function(item) {
				context.beginPath();
				context.arc(item.x, item.y, 1, 0, PI2);
				context.fill();
				context.closePath();
			});
		}

		/**
		 * [createSide 连接各顶点]
		 * @param  {[object]} context [画布]
		 * @return {[void]}
		 */
		function lineToSide(context) {
			var sides = side_points();
			context.globalAlpha = opacity.value;
			context.beginPath();
			context.fillStyle = fill.value;
			context.strokeStyle = stroke.value;
			// context.moveTo(sides[0].x, sides[0].y);
			sides.forEach(function(item) {
				context.lineTo(item.x, item.y);
			});
			context.fill();
			context.stroke();
			context.closePath();
		}

		/**
		 * [onchange]
		 * @param  {[object]} context [画布]
		 * @return {[void]}
		 */
		function onchange(context) {
			SIDE = range_side.value;
			span_side.innerText = SIDE;
			span_opacity.innerText = opacity.value;
			span_rotate.innerText = rotate.value;
			span_fill.innerText = fill.value;
			span_stroke.innerText = stroke.value;

			clear(context);
			lineToSide(context);
			createCanvasImage(polygon_range_side, context);
		}

		function onchangeHandler() {
			onchange(context);
		}

		// init
		var polygon_dot = $('polygon_dot'), // 中心点
			polygon_radius = $('polygon_radius'), // 半径
			polygon_points = $('polygon_points'), // 各顶点集合
			polygon_sides = $('polygon_sides'), // 边
			span_rotate = $('span_rotate'), // 旋转
			rotate = $('rotate'), // 旋转
			span_opacity = $('span_opacity'), // 旋转
			opacity = $('opacity'), // 透明
			range_side = $('range_side'), 
			polygon_range_side = $('polygon_range_side'), 
			span_stroke = $('span_stroke'), 
			stroke = $('stroke'), 
			span_fill = $('span_fill'),
			fill = $('fill'),
			span_side = $('span_side'),
			PI2 = Math.PI * 2,
			DOTS_RADIUS = 3,
			LINE_WIDTH = 1,
			SIDE = range_side.value,
			context = createCanvas(),
			WIDTH = context.canvas.width,
			HEIGHT = context.canvas.height,
			RADIUS = WIDTH / 2 - LINE_WIDTH;

			createDots(context);
			createCanvasImage(polygon_dot, context);
			clear(context);

			createRadius(context);
			createCanvasImage(polygon_radius, context);
			clear(context);

			createSide(context);
			createCanvasImage(polygon_points, context);
			clear(context);

			lineToSide(context);
			createCanvasImage(polygon_sides, context);
			
			onchangeHandler();
			fill.onchange = onchangeHandler;
			stroke.onchange = onchangeHandler;
			rotate.onchange = onchangeHandler;
			opacity.onchange = onchangeHandler;
			range_side.onchange = onchangeHandler;
	})();

</script>
