---
title: canvas圆形轨迹 
categories: 前端
tags: [javascript, html5, canvas]
date: 2017/5/9 13:33:34 
---

<h2>画圆</h2>
<p>用canvas来画圆是一个很简单的事情，我们只需要套用他的api，就可以轻松搞定</p>

```js
	/**
	 * @param  {[number]} x [圆的中心的 x 坐标]
	 * @param  {[number]} y [圆的中心的 y 坐标]
	 * @param  {[number]} radius [圆的半径]
	 * @param  {[number]} sAngle [起始角，以弧度计]
	 * @param  {[number]} eAngle [结束角，以弧度计]
	 * @param  {[boolean]} counterclockwise [可选。规定应该逆时针还是顺时针绘图。
	False = 顺时针，true = 逆时针。]
	 */
	context.arc(x, y, radius, sAngle, eAngle, counterclockwise);
```

<p>但是好多时候我们不只局限于画圆，我们还想知道圆的轨迹，也就是圆上的坐标</p>

<!-- more -->

<h2>圆的轨迹</h2>
<div id="circle_dots"></div>

<p>计算圆的轨迹我们需要知道以下几点：</p>

<p>已知：</p>
<ul>
	<li>圆的中心cx, cy</li>
	<li>圆的半径 radius</li>
	<li>角度θ（0°~360°）</li>
</ul>

<p>未知：</p>
<ul>
	<li>圆上的x坐标: x</li>
	<li>圆上的y坐标: y</li>
</ul>

<h2>图形详解</h2>
<div id="circle_detail"></div>

<h2>三角函数公式</h2>

<p>在直角三角形中</p>

```js
	a = Math.sin(θ) * c;
	b = Math.cos(θ) * c;

```

<p>套用以上公式得出：</p>

```js
	x = Math.cos(θ) * radius + cx;
	y = Math.sin(θ) * radius + cy;

```
<p>其中θ表示弧度，我们需要把我们说的角度转化为弧度</p>


<h2>角度转弧度公式</h2>

```js
	// 360° = Math.PI * 2;
	// 1°   = Math.PI * 2 / 360;
	function d2a(n) {
		return n * Math.PI / 180;
	}
```

因此得出的圆轨迹

```js
	x = Math.cos(d2a(n)) * radius + cx;
	y = Math.sin(d2a(n)) * radius + cy;

```

<div id="circle_end"></div>


<h2><a target="_black" href="https://github.com/jxchenvip/demo/blob/dev/project/canvas/circle/index.html">#下载源码</a></h2>

<script>

	(function() {
		
		// 不支持canvas
		if(!document.createElement('canvas').getContext) return false;

		/**
		 * [createCanvas 创建canvas元素]
		 * @return {[object]}
		 */
		function createCanvas() {
			var canvas =  document.createElement('canvas');
			var context = canvas.getContext('2d');
			canvas.width = WIDTH;
			canvas.height = HEIGHT;
			return context;
		}

		/**
		 * [$ 获取id]
		 * @param  {[String]} id
		 * @return {[object]} dom节点
		 */
		function $(id) {
			return document.getElementById(id);
		}

		/**
		 * [clear 清除画布]
		 * @param  {[object]} context
		 * @return {[void]}       
		 */
		function clear(context) {
			context.clearRect(0, 0, WIDTH, HEIGHT);
		}

		/**
		 * [createCanvasImage description]
		 * @param  {[object]} ele     [dom节点]
		 * @param  {[object]} context [画布]
		 * @return {[void]}
		 */
		function createCanvasImage(ele, context) {
			var img = ele.getElementsByTagName('img')[0],
				a = ele.getElementsByTagName('a')[0];
				src = context.canvas.toDataURL();
			if(a) {
				a.href = src;
				img.src = src;
			} else {

				ele.innerHTML = "<a href="+src+" class='fancybox fancybox.image' rel='group'><img src="+src+" alt='' /></a>";
			}
		}


		/**
		 * [d2a 角度转弧度]
		 * @param  {[number]} n [角度]
		 * @return {[number]}   [弧度]
		 */
		function d2a(n) {
			return n * Math.PI / 180;
		}

		function create_circle_dots(context, x, y, radius) {
			context.beginPath();
			context.arc(x, y, radius, d2a(0), d2a(360));
			context.fill();
			context.closePath();
		}

		function create_circle_dots_stroke(context, x, y, radius) {
			context.beginPath();
			context.arc(x, y, radius, d2a(0), d2a(360));
			context.stroke();
			context.closePath();
		}

		function createCrocess(context, r) {
			var angle = d2a(-30),
				x = Math.cos(angle) * r + CX,
				y = Math.sin(angle) * r + CY, 
				h = 10;
				i = (1 + 1/3);
			context.beginPath();
			// x
			context.moveTo(0, CY);
			context.lineTo(WIDTH, CY);
			// y
			context.moveTo(CX, 0);
			context.lineTo(CX, HEIGHT);
			// angle
			context.moveTo(CX, CY);
			context.lineTo(x, y);
			context.lineTo(x, CY);

			// angle
			context.moveTo(x, CY - h);
			context.lineTo(x - h, CY-h);
			context.lineTo(x - h, CY);

			// 圆弧
			context.moveTo(CX, CY);
			context.arc(CX, CY, h * 2, 0, angle, true);

			context.stroke();
			context.closePath();

			createText(context, 'c', CX * i, y);
			createText(context, 'b', CX * i, CY + h);
			createText(context, 'θ', CX * i, CY - h);
			createText(context, 'a', x + h, y * i);
			createText(context, '(x, y)', x + h * 2, y);
			createText(context, '(cx, cy)', CX, CY + h);
		}

		function createText(context, font, x, y) {
			context.textAlign = 'center';
			context.textBaseline = 'middle';
			context.font = '14px Arial';
			context.fillText(font, x, y);
		}



		function domInScreen(dom) {
			var st = document.body.scrollTop,
				wh = window.innerHeight,
				dt = dom.offsetTop;
			return dt < st + wh;
		}


		var WIDTH = 200,
			HEIGHT = 200,
			LINEWIDTH = 1,
			RADIUS = WIDTH / 2 - LINEWIDTH - 5,
			CX = WIDTH / 2,
			CY = HEIGHT / 2;

		// 画圆

		// 圆的轨迹
		({
			start: function(context) {
				var that = this;
				this.timer = setInterval(function() {
					var angle = d2a(that.i+=1);
					var x = (Math.cos(angle) * RADIUS + CX).toFixed();
					var y = (Math.sin(angle) * RADIUS + CY).toFixed(); 
					clear(context);
					create_circle_dots(context, x, y, that.RADIUS);
					createCanvasImage(that.dom, context);
					if(that.i > 360) {
						clearInterval(that.timer);
						that.timer = null;
					}
				}, this.TIME);
			},
			init: function() {
				var that = this;
				this.dom = $('circle_dots');
				this.RADIUS = 3;
				this.timer = null;
				this.TIME = 1000/30;
				this.i = 0;
				this.context = createCanvas();
				var first = true;
				// this.start(this.context);
				window.addEventListener('scroll', function() {
					if(domInScreen(that.dom)){
						if(first) {
							first = false;
					 		that.start(that.context)
					 	}
					}
				}, false)
			}

		}).init();


		// 坐标详解
		({
			start: function(context) {
				clear(context);
				createCrocess(context, this.RADIUS)
				create_circle_dots_stroke(context, CX, CY, this.RADIUS);
				createCanvasImage(this.dom, context);
			},
			init: function() {
				this.dom = $('circle_detail');
				this.RADIUS = RADIUS - 20;
				this.context = createCanvas();
				this.start(this.context);
			}

		}).init();


		// 坐标详解
		({
			start: function(context) {
				var that = this;
				this.timer = setInterval(function() {
					var angle = d2a(that.i+=1);
					var x = (Math.cos(angle) * that.RADIUS + CX).toFixed();
					var y = (Math.sin(angle) * that.RADIUS + CY).toFixed(); 
					clear(context);
					create_circle_dots_stroke(context, CX, CY, that.RADIUS);
					createText(context, "("+x+", "+y+")", x, y);
					createCanvasImage(that.dom, context);
					if(that.i > 360) {
						clearInterval(that.timer);
						that.timer = null;
					}
				}, this.TIME);
			},
			init: function() {
				var that = this;
				this.dom = $('circle_end');
				this.RADIUS = RADIUS - 30;
				this.timer = null;
				this.TIME = 1000 / 30;
				this.i = 0;
				this.context = createCanvas();
				var first = true;
				// this.start(this.context);
				window.addEventListener('scroll', function() {
					if(domInScreen(that.dom)){
						if(first) {
							first = false;
					 		that.start(that.context)
					 	}
					}
				}, false)
			}

		}).init();


	})();

</script>
