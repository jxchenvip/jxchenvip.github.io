---
title: Vue2.0 组件通信
tags: [前端,vue,vue组件,vue数据传递]
categories: [前端, Vue]
date: 2017-06-13 15:10:47
---

最近在做vue项目，因为第一次使用vue, 尝到了一此甜头的同时也吃了不少灰。抽时间把项目期间踩过的坑在这里记录一下，增加一些记忆。

## 组件通信

组件间的通信包括，父子、兄弟组件之间的通信。

父子组件之间通信有两种情况：

* 父组件向子组件传递数据
* 子组件向父组件传递数据

<!-- more -->

## 父向子传

父组件向子组件传递数据通过子组件注册的属性

```html
    <!-- 子组件 -->
    <!-- 传递的一个变量 -->
    <Child :msg="parentMsg"></Child> 
```

```js
    // 父组件
    new Vue({
        el: '#main',
        components: {
            Child
        },
        data() {
            return {
                parentMsg: '父组件数据'
            }
        }
    });
```
上面的子组件需要注意的是：

```html
<!-- 传递了一个字符串 "1" -->
<Child msg="1"></Child>

<!-- 传递实际的 number -->
<Child v-bind:msg="1"></Child>
<!-- bind缩写为: -->
<Child :msg="1"></Child>

```

*** 注意在 JavaScript 中对象和数组是引用类型，指向同一个内存空间，如果 prop 是一个对象或数组，在子组件内部改变它会影响父组件的状态。***

## 子向父传

```js
// 编写子组件
Vue.component('Child', {
    template: `<div @click="clickHandler"></div>`,
    data() {
        return {
            info: '子组件信息'
        };
    },
    methods: {
        clickHandler() {
            this.$emit('on-click', this.info); // 触发事件
        }
    }
});

// 引用
<Child @on-click="parentClickHandler"></Child>

// 注册到父组件
new Vue({
    components: {
        Child
    },
    methods: {
        parentClickHandler(info) {
            console.log(`接收到子组件传递的信息${info}`); // 接受信息
        }
    }
})

```
* 使用 $on(eventName) 监听事件
* 使用 $emit(eventName) 触发事件

这是子组件通过自定义事件向父组件传递数据。

### .sync
有时候需要对porps进行『双向绑定』。

```html
<Child :msg.sync="parentMsg"></Child>
```
会被扩展为：

```html
<Child :msg="parentMsg" @update:msg="val=> parentMsg = val"></Child>
```

当子组件需要更新 msg 的值时，它需要显式地触发一个更新事件：

```js
Vue.component('Child', {
    template: `<div @click="clickHandler"></div>`,
    data() {
        return {
            info: '子组件信息'
        };
    },
    methods: {
        clickHandler() {
            this.$emit('update:msg', this.info); // 更新事件
        }
    }
});
```

### 表单

要让组件的 v-model 生效，它必须：
* 接受一个 value 属性
* 在有新的 value 时触发 input 事件

```js
// 表单组件
Vue.component('Child', {
    template: `<input :value="value" @input="updateValue($event.target.value)" type="text />`, // @input重点
    porps: {
        value: {}
    },
    methods: {
        updateValue(value) {
            this.$emit('input', value); // 更新v-model
        }
    }
});

// 绑定
<Child v-model="something"></Child>

new Vue({
    el: '#main',
    data() {
        return {
            something: 'something'
        }
    }
})
```

    

## 兄弟之间传递

```js
var bus = new Vue()

// 触发组件 A 中的事件
bus.$emit('id-selected', 1)

// 在组件 B 创建的钩子中监听事件
bus.$on('id-selected', function (id) {
  // ...
})
```


\*_详情请移步-->[Vue官网](https://cn.vuejs.org/v2/guide/components.html#Prop)_